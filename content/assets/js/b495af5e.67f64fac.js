"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[52387],{3905:(e,a,t)=>{t.d(a,{Zo:()=>u,kt:()=>g});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=n.createContext({}),c=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},u=function(e){var a=c(e.components);return n.createElement(l.Provider,{value:a},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=c(t),m=r,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||s;return t?n.createElement(g,i(i({ref:a},u),{},{components:t})):n.createElement(g,i({ref:a},u))}));function g(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var s=t.length,i=new Array(s);i[0]=m;var o={};for(var l in a)hasOwnProperty.call(a,l)&&(o[l]=a[l]);o.originalType=e,o[p]="string"==typeof e?e:r,i[1]=o;for(var c=2;c<s;c++)i[c]=t[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},85162:(e,a,t)=>{t.d(a,{Z:()=>i});var n=t(67294),r=t(86010);const s={tabItem:"tabItem_Ymn6"};function i(e){let{children:a,hidden:t,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(s.tabItem,i),hidden:t},a)}},74866:(e,a,t)=>{t.d(a,{Z:()=>N});var n=t(87462),r=t(67294),s=t(86010),i=t(12466),o=t(16550),l=t(91980),c=t(67392),u=t(50012);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:a,label:t,attributes:n,default:r}}=e;return{value:a,label:t,attributes:n,default:r}}))}function d(e){const{values:a,children:t}=e;return(0,r.useMemo)((()=>{const e=a??p(t);return function(e){const a=(0,c.l)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,t])}function m(e){let{value:a,tabValues:t}=e;return t.some((e=>e.value===a))}function g(e){let{queryString:a=!1,groupId:t}=e;const n=(0,o.k6)(),s=function(e){let{queryString:a=!1,groupId:t}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:a,groupId:t});return[(0,l._X)(s),(0,r.useCallback)((e=>{if(!s)return;const a=new URLSearchParams(n.location.search);a.set(s,e),n.replace({...n.location,search:a.toString()})}),[s,n])]}function k(e){const{defaultValue:a,queryString:t=!1,groupId:n}=e,s=d(e),[i,o]=(0,r.useState)((()=>function(e){let{defaultValue:a,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!m({value:a,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:a,tabValues:s}))),[l,c]=g({queryString:t,groupId:n}),[p,k]=function(e){let{groupId:a}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(a),[n,s]=(0,u.Nk)(t);return[n,(0,r.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:n}),h=(()=>{const e=l??p;return m({value:e,tabValues:s})?e:null})();(0,r.useLayoutEffect)((()=>{h&&o(h)}),[h]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),c(e),k(e)}),[c,k,s]),tabValues:s}}var h=t(72389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:a,block:t,selectedValue:o,selectValue:l,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),d=e=>{const a=e.currentTarget,t=u.indexOf(a),n=c[t].value;n!==o&&(p(a),l(n))},m=e=>{let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=u.indexOf(e.currentTarget)+1;a=u[t]??u[0];break}case"ArrowLeft":{const t=u.indexOf(e.currentTarget)-1;a=u[t]??u[u.length-1];break}}a?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":t},a)},c.map((e=>{let{value:a,label:t,attributes:i}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:o===a?0:-1,"aria-selected":o===a,key:a,ref:e=>u.push(e),onKeyDown:m,onClick:d},i,{className:(0,s.Z)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":o===a})}),t??a)})))}function T(e){let{lazy:a,children:t,selectedValue:n}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(a){const e=s.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},s.map(((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==n}))))}function b(e){const a=k(e);return r.createElement("div",{className:(0,s.Z)("tabs-container",f.tabList)},r.createElement(v,(0,n.Z)({},e,a)),r.createElement(T,(0,n.Z)({},e,a)))}function N(e){const a=(0,h.Z)();return r.createElement(b,(0,n.Z)({key:String(a)},e))}},88253:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>u,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>c,toc:()=>p});var n=t(87462),r=(t(67294),t(3905)),s=t(74866),i=t(85162);const o={id:"admin-api-transactions",title:"Manage transactions",sidebar_label:"Transactions"},l=void 0,c={unversionedId:"admin-api-transactions",id:"admin-api-transactions",title:"Manage transactions",description:"This page only shows some frequently used operations.",source:"@site/docs/admin-api-transactions.md",sourceDirName:".",slug:"/admin-api-transactions",permalink:"/docs/next/admin-api-transactions",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/docs/admin-api-transactions.md",tags:[],version:"current",frontMatter:{id:"admin-api-transactions",title:"Manage transactions",sidebar_label:"Transactions"},sidebar:"docsSidebar",previous:{title:"Topics",permalink:"/docs/next/admin-api-topics"},next:{title:"Tools",permalink:"/docs/next/admin-api-tools"}},u={},p=[{value:"Transaction resources",id:"transaction-resources",level:2},{value:"GetSlowTransactions",id:"getslowtransactions",level:3},{value:"ScaleTransactionCoordinators",id:"scaletransactioncoordinators",level:3},{value:"Transaction stats",id:"transaction-stats",level:2},{value:"Get transaction metadata",id:"get-transaction-metadata",level:3},{value:"Get transaction stats in transaction pending ack",id:"get-transaction-stats-in-transaction-pending-ack",level:3},{value:"Get transaction stats in transaction buffer",id:"get-transaction-stats-in-transaction-buffer",level:3},{value:"Transaction coordinator stats",id:"transaction-coordinator-stats",level:2},{value:"Get coordinator stats",id:"get-coordinator-stats",level:3},{value:"Get coordinator internal stats",id:"get-coordinator-internal-stats",level:3},{value:"Transaction pending ack stats",id:"transaction-pending-ack-stats",level:2},{value:"Get transaction pending ack stats",id:"get-transaction-pending-ack-stats",level:3},{value:"Get transaction pending ack internal stats",id:"get-transaction-pending-ack-internal-stats",level:3},{value:"Get position stats in pending ack",id:"get-position-stats-in-pending-ack",level:3},{value:"Transaction buffer stats",id:"transaction-buffer-stats",level:2},{value:"Get transaction buffer stats",id:"get-transaction-buffer-stats",level:3}],d={toc:p},m="wrapper";function g(e){let{components:a,...t}=e;return(0,r.kt)(m,(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"This page only shows ",(0,r.kt)("strong",{parentName:"p"},"some frequently used operations"),"."),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For the latest and complete information about ",(0,r.kt)("inlineCode",{parentName:"p"},"Pulsar admin"),", including commands, flags, descriptions, and more, see ",(0,r.kt)("a",{parentName:"p",href:"pathname:///reference/#/next/pulsar-admin/"},"Pulsar admin docs"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For the latest and complete information about ",(0,r.kt)("inlineCode",{parentName:"p"},"REST API"),", including parameters, responses, samples, and more, see ",(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/admin-rest-api#/"},"REST")," API doc.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"For the latest and complete information about ",(0,r.kt)("inlineCode",{parentName:"p"},"Java admin API"),", including classes, methods, descriptions, and more, see ",(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/api/admin/3.0.x/"},"Java admin API doc"),".")))),(0,r.kt)("h2",{id:"transaction-resources"},"Transaction resources"),(0,r.kt)("h3",{id:"getslowtransactions"},"GetSlowTransactions"),(0,r.kt)("p",null,"In the production environment, there may be some long-lasting transactions that have never been completed. You can get these slow transactions that have survived over a certain time under a coordinator or all coordinators in the following ways."),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions slow-transactions -c 1 -t 1s\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getSlowTransactions"},"GET /admin/v3/transactions/slowTransactions/:timeout"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getSlowTransactionsByCoordinatorId(coordinatorId, timeout, timeUnit)\n//Or get slow transactions from all coordinators\nadmin.transactions().getSlowTransactions(timeout, timeUnit)\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "(0,3)": {\n    "txnId": "(0,3)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122474,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,2)": {\n    "txnId": "(0,2)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122471,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,5)": {\n    "txnId": "(0,5)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122478,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,4)": {\n    "txnId": "(0,4)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122476,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,7)": {\n    "txnId": "(0,7)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122482,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,10)": {\n    "txnId": "(0,10)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122488,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,6)": {\n    "txnId": "(0,6)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122480,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,9)": {\n    "txnId": "(0,9)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122486,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,8)": {\n    "txnId": "(0,8)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122484,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  },\n  "(0,11)": {\n    "txnId": "(0,11)",\n    "status": "OPEN",\n    "openTimestamp": 1658120122490,\n    "timeoutAt": 300000,\n    "producedPartitions": {},\n    "ackedPartitions": {}\n  }\n}\n')),(0,r.kt)("h3",{id:"scaletransactioncoordinators"},"ScaleTransactionCoordinators"),(0,r.kt)("p",null,"When the performance of transactions reaches a bottleneck due to the insufficient number of transaction coordinators, you can scale the number of the transaction coordinators in the following ways."),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions scale-transactionCoordinators -r 17\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/scaleTransactionCoordinators"},"GET /admin/v3/transactions/transactionCoordinator/:replicas"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().scaleTransactionCoordinators(replicas);\n")))),(0,r.kt)("h2",{id:"transaction-stats"},"Transaction stats"),(0,r.kt)("h3",{id:"get-transaction-metadata"},"Get transaction metadata"),(0,r.kt)("p",null,"The transaction metadata that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"txnId:")," The ID of this transaction."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"status:")," The status of this transaction."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"openTimestamp:")," The open time of this transaction."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"timeoutAt:")," The timeout of this transaction."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"producedPartitions:")," The partitions or topics that messages have been sent to with this transaction."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ackedPartitions:")," The partitions or topics where messages have been acknowledged with this transaction.")),(0,r.kt)("p",null,"Use one of the following ways to get your transaction metadata."),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions transaction-metadata -m 1 -l 1\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getTransactionMetadata"},"GET /admin/v3/transactions/transactionMetadata/:mostSigBits/:leastSigBits"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getTransactionMetadata(txnID);\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n "txnId" : "(1,18)",\n "status" : "ABORTING",\n "openTimestamp" : 1656592983374,\n "timeoutAt" : 5000,\n "producedPartitions" : {\n   "my-topic" : {\n     "startPosition" : "127:4959",\n     "aborted" : true\n   }\n },\n "ackedPartitions" : {\n   "my-topic" : {\n     "mysubName" : {\n       "cumulativeAckPosition" : null\n     }\n   }\n }\n}\n')),(0,r.kt)("h3",{id:"get-transaction-stats-in-transaction-pending-ack"},"Get transaction stats in transaction pending ack"),(0,r.kt)("p",null,"The transaction stats in transaction pending ack that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cumulativeAckPosition:")," The position that this transaction cumulatively acknowledges in this subscription.")),(0,r.kt)("p",null,"Use one of the following ways to get transaction stats in pending ack:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions transaction-in-pending-ack-stats -m 1 -l 1 -t my-topic -s mysubname\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getTransactionInPendingAckStats"},"GET /admin/v3/transactions/transactionInPendingAckStats/:tenant/:namespace/:topic/:subName/:mostSigBits/:leastSigBits"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getTransactionInPendingAckStats(txnID, topic, subname);\n")))),(0,r.kt)("p",null,"The following is an example of the returned value."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n "cumulativeAckPosition" : "137:49959"\n }\n')),(0,r.kt)("h3",{id:"get-transaction-stats-in-transaction-buffer"},"Get transaction stats in transaction buffer"),(0,r.kt)("p",null,"The transaction stats in the transaction buffer that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"startPosition:")," The start position of this transaction in the transaction buffer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"aborted:")," The flag of whether this transaction has been aborted.")),(0,r.kt)("p",null,"Use one of the following ways to get transaction stats in transaction buffer:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions transaction-in-buffer-stats -m 1 -l 1 -t my-topic\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getTransactionInBufferStats"},"GET /admin/v3/transactions/transactionInBufferStats/:tenant/:namespace/:topic/:mostSigBits/:leastSigBits"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getTransactionInBufferStatsAsync(txnID, topic);\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n "startPosition" : "137:49759",\n "aborted" : false\n}\n')),(0,r.kt)("h2",{id:"transaction-coordinator-stats"},"Transaction coordinator stats"),(0,r.kt)("p",null,"The transaction coordinator (TC) is a module inside a Pulsar broker. It maintains the entire life cycle of transactions and handles transaction timeout."),(0,r.kt)("h3",{id:"get-coordinator-stats"},"Get coordinator stats"),(0,r.kt)("p",null,"The transaction coordinator stats that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"state:"),"  The state of this transaction coordinator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"leastSigBit:s")," The sequence ID of this transaction coordinator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"lowWaterMark:")," The low watermark of this transaction coordinator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ongoingTxnSize:")," The total number of ongoing transactions in this transaction coordinator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"recoverStartTime:")," The start timestamp of transaction coordinator recovery. ",(0,r.kt)("inlineCode",{parentName:"li"},"0L")," means no startup."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"recoverEndTime:")," The end timestamp of transaction coordinator recovery. ",(0,r.kt)("inlineCode",{parentName:"li"},"0L")," means no startup.")),(0,r.kt)("p",null,"Use one of the following ways to get transaction coordinator stats:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions coordinator-stats -c 1\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getCoordinatorStats"},"GET /admin/v3/transactions/coordinatorStats"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getCoordinatorStatsById(coordinatorId);\n//Or get all coordinator stats.\nadmin.transactions().getCoordinatorStats();\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "state" : "Ready",\n  "leastSigBits" : 1,\n  "lowWaterMark" : 0,\n  "ongoingTxnSize" : 0,\n  "recoverStartTime" : 1657021892377,\n  "recoverEndTime" : 1657021892378\n}\n')),(0,r.kt)("h3",{id:"get-coordinator-internal-stats"},"Get coordinator internal stats"),(0,r.kt)("p",null,"The coordinator's internal stats that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"transactionLogStats:")," The stats of the transaction coordinator log."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"managedLedgerName:")," The name of the managed ledger where the transaction coordinator log is stored."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"managedLedgerInternalStats:")," The internal stats of the managed ledger where the transaction coordinator log is stored. See ",(0,r.kt)("inlineCode",{parentName:"li"},"[managedLedgerInternalStats](/docs/next/admin-api-topics#get-internal-stats)")," for more details.")),(0,r.kt)("p",null,"Use one of the following ways to get coordinator's internal stats:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions coordinator-internal-stats -c 1 -m\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getCoordinatorInternalStats"},"GET /admin/v3/transactions/coordinatorInternalStats/:coordinatorId"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getCoordinatorInternalStats(coordinatorId, metadata);\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n "transactionLogStats" : {\n   "managedLedgerName" : "pulsar/system/persistent/__transaction_log_1",\n   "managedLedgerInternalStats" : {\n     "entriesAddedCounter" : 3,\n     "numberOfEntries" : 3,\n     "totalSize" : 63,\n     "currentLedgerEntries" : 3,\n     "currentLedgerSize" : 63,\n     "lastLedgerCreatedTimestamp" : "2022-06-30T18:18:05.88+08:00",\n     "waitingCursorsCount" : 0,\n     "pendingAddEntriesCount" : 0,\n     "lastConfirmedEntry" : "13:2",\n     "state" : "LedgerOpened",\n     "ledgers" : [ {\n       "ledgerId" : 13,\n       "entries" : 0,\n       "size" : 0,\n       "offloaded" : false,\n       "metadata" : "LedgerMetadata{formatVersion=3, ensembleSize=1, writeQuorumSize=1, ackQuorumSize=1, state=CLOSED, length=63, lastEntryId=2, digestType=CRC32C, password=OMITTED, ensembles={0=[10.20.240.119:3181]}, customMetadata={component=base64:bWFuYWdlZC1sZWRnZXI=, pulsar/managed-ledger=base64:cHVsc2FyL3N5c3RlbS9wZXJzaXN0ZW50L19fdHJhbnNhY3Rpb25fbG9nXzE=, application=base64:cHVsc2Fy}}",\n       "underReplicated" : false\n     } ],\n     "cursors" : {\n       "transaction.subscription" : {\n         "markDeletePosition" : "13:2",\n         "readPosition" : "13:3",\n         "waitingReadOp" : false,\n         "pendingReadOps" : 0,\n         "messagesConsumedCounter" : 3,\n         "cursorLedger" : 22,\n         "cursorLedgerLastEntry" : 1,\n         "individuallyDeletedMessages" : "[]",\n         "lastLedgerSwitchTimestamp" : "2022-06-30T18:18:05.932+08:00",\n         "state" : "Open",\n         "numberOfEntriesSinceFirstNotAckedMessage" : 1,\n         "totalNonContiguousDeletedMessagesRange" : 0,\n         "subscriptionHavePendingRead" : false,\n         "subscriptionHavePendingReplayRead" : false,\n         "properties" : { }\n       }\n     }\n   }\n }\n}\n')),(0,r.kt)("h2",{id:"transaction-pending-ack-stats"},"Transaction pending ack stats"),(0,r.kt)("p",null,"Pending ack maintains message acknowledgments within a transaction before a transaction completes. If a message is in the pending acknowledge state, the message cannot be acknowledged by other transactions until the message is removed from the pending acknowledge state."),(0,r.kt)("h3",{id:"get-transaction-pending-ack-stats"},"Get transaction pending ack stats"),(0,r.kt)("p",null,"The transaction pending ack state stats that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"state:")," The state of this transaction coordinator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"lowWaterMark:")," The low watermark of this transaction coordinator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ongoingTxnSize:")," The total number of ongoing transactions in this transaction coordinator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"recoverStartTime:")," The start timestamp of transaction pendingAck recovery. ",(0,r.kt)("inlineCode",{parentName:"li"},"0L")," means no startup."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"recoverEndTime:")," The end timestamp of transaction pendingAck recovery. ",(0,r.kt)("inlineCode",{parentName:"li"},"0L")," means no startup.")),(0,r.kt)("p",null,"Use one of the following ways to get transaction pending ack stats:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin.transactions()s pending-ack-stats -t my-topic -s mysubName -l\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getPendingAckStats"},"GET /admin/v3/transactions/pendingAckStats/:tenant/:namespace:/:topic:/:subName"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getPendingAckStats(topic, subName, lowWaterMarks)\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "state" : "Ready",\n  "lowWaterMarks" : {\n    "1" : 0\n  },\n  "ongoingTxnSize" : 1,\n  "recoverStartTime" : 1657021899202,\n  "recoverEndTime" : 1657021899203\n}\n')),(0,r.kt)("h3",{id:"get-transaction-pending-ack-internal-stats"},"Get transaction pending ack internal stats"),(0,r.kt)("p",null,"The transaction pending ack internal stats that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"transactionLogStats:")," The stats of the transaction pending ack log."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"managedLedgerName:")," The name of the managed ledger where the transaction pending ack log is stored."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"managedLedgerInternalStats:")," The internal stats of the managed ledger where the transaction coordinator log is stored. See ",(0,r.kt)("inlineCode",{parentName:"li"},"[managedLedgerInternalStats](/docs/next/admin-api-topics#get-internal-stats)")," for more details.")),(0,r.kt)("p",null,"Use one of the following ways to get transaction pending ack internal stats:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions pending-ack-internal-stats -t my-topic -s mysubName -m\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getPendingAckInternalStats"},"GET /admin/v3/transactions/pendingAckInternalStats/:tenant/:namespace:/:topic:/:subName"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getPendingAckInternalStats(topic, subName, boolean metadata);\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n "pendingAckLogStats" : {\n   "managedLedgerName" : "public/default/persistent/my-topic-mysubName__transaction_pending_ack",\n   "managedLedgerInternalStats" : {\n     "entriesAddedCounter" : 2247,\n     "numberOfEntries" : 2247,\n     "totalSize" : 37212,\n     "currentLedgerEntries" : 104,\n     "currentLedgerSize" : 1732,\n     "lastLedgerCreatedTimestamp" : "2022-06-30T19:02:09.746+08:00",\n     "waitingCursorsCount" : 0,\n     "pendingAddEntriesCount" : 52,\n     "lastConfirmedEntry" : "64:51",\n     "state" : "LedgerOpened",\n     "ledgers" : [ {\n       "ledgerId" : 56,\n       "entries" : 2195,\n       "size" : 36346,\n       "offloaded" : false,\n       "metadata" : "LedgerMetadata{formatVersion=3, ensembleSize=1, writeQuorumSize=1, ackQuorumSize=1, state=CLOSED, length=36346, lastEntryId=2194, digestType=CRC32C, password=OMITTED, ensembles={0=[10.20.240.119:3181]}, customMetadata={component=base64:bWFuYWdlZC1sZWRnZXI=, pulsar/managed-ledger=base64:cHVibGljL2RlZmF1bHQvcGVyc2lzdGVudC9teS10b3BpYy1teXN1Yk5hbWVfX3RyYW5zYWN0aW9uX3BlbmRpbmdfYWNr, application=base64:cHVsc2Fy}}",\n       "underReplicated" : false\n     }, {\n       "ledgerId" : 64,\n       "entries" : 0,\n       "size" : 0,\n       "offloaded" : false,\n       "metadata" : "LedgerMetadata{formatVersion=3, ensembleSize=1, writeQuorumSize=1, ackQuorumSize=1, state=CLOSED, length=866, lastEntryId=51, digestType=CRC32C, password=OMITTED, ensembles={0=[10.20.240.119:3181]}, customMetadata={component=base64:bWFuYWdlZC1sZWRnZXI=, pulsar/managed-ledger=base64:cHVibGljL2RlZmF1bHQvcGVyc2lzdGVudC9teS10b3BpYy1teXN1Yk5hbWVfX3RyYW5zYWN0aW9uX3BlbmRpbmdfYWNr, application=base64:cHVsc2Fy}}",\n       "underReplicated" : false\n     } ],\n     "cursors" : {\n       "__pending_ack_state" : {\n         "markDeletePosition" : "56:-1",\n         "readPosition" : "56:0",\n         "waitingReadOp" : false,\n         "pendingReadOps" : 0,\n         "messagesConsumedCounter" : 0,\n         "cursorLedger" : 57,\n         "cursorLedgerLastEntry" : 0,\n         "individuallyDeletedMessages" : "[]",\n         "lastLedgerSwitchTimestamp" : "2022-06-30T18:55:26.842+08:00",\n         "state" : "Open",\n         "numberOfEntriesSinceFirstNotAckedMessage" : 1,\n         "totalNonContiguousDeletedMessagesRange" : 0,\n         "subscriptionHavePendingRead" : false,\n         "subscriptionHavePendingReplayRead" : false,\n         "properties" : { }\n       }\n     }\n   }\n }\n}\n')),(0,r.kt)("h3",{id:"get-position-stats-in-pending-ack"},"Get position stats in pending ack"),(0,r.kt)("p",null,"The position stats in pending ack include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PendingAck")," The position is in pending ack stats."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"MarkDelete")," The position is already acknowledged."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"NotInPendingAck")," The position is not acknowledged within a transaction."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"PendingAckNotReady")," The pending ack has not been initialized."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"InvalidPosition")," The position is invalid, for example, batch index > batch size.")),(0,r.kt)("p",null,"If you want to know whether the position has been acknowledged, you can use one of the following ways to get position stats pending ack:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions position-stats-in-pending-ack -t my-topic -s mysubName -l 15 -e 6\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getPositionStatsInPendingAck"},"GET /admin/v3/transactions/pendingAckStats\n/:tenant/:namespace:/:topic:/:subName/:ledgerId/:entryId?batchIndex=batchIndex"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getPositionStatsInPendingAckAsync(topic, subName, ledgerId, entryId, lowWaterMarks);\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "State" : "MarkDelete"\n}\n')),(0,r.kt)("h2",{id:"transaction-buffer-stats"},"Transaction buffer stats"),(0,r.kt)("p",null,"Transaction buffer handles messages produced to a topic partition within a transaction.\nThe messages in the transaction buffer are not visible to consumers until the transactions are committed. The messages in the transaction buffer are discarded when the transactions are aborted."),(0,r.kt)("h3",{id:"get-transaction-buffer-stats"},"Get transaction buffer stats"),(0,r.kt)("p",null,"The transaction buffer stats that can be retrieved include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"state:")," The state of this transaction buffer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"maxReadPosition:")," The maximum read position of this transaction buffer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"lastSnapshotTimestamps:")," The last snapshot timestamp of this transaction buffer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"lowWaterMarks (Optional):")," The low watermark details of the transaction buffer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ongoingTxnSize:")," The total number of ongoing transactions in this transaction buffer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"recoverStartTime:")," The start timestamp of transaction buffer recovery. ",(0,r.kt)("inlineCode",{parentName:"li"},"0L")," means no startup."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"recoverEndTime:")," The end timestamp of transaction buffer recovery. ",(0,r.kt)("inlineCode",{parentName:"li"},"0L")," means no startup.")),(0,r.kt)("p",null,"Use one of the following ways to get transaction buffer stats:"),(0,r.kt)(s.Z,{groupId:"api-choice",defaultValue:"pulsar-admin",values:[{label:"pulsar-admin",value:"pulsar-admin"},{label:"REST API",value:"REST API"},{label:"Java",value:"Java"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"pulsar-admin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-admin transactions transaction-buffer-stats -t my-topic -l\n"))),(0,r.kt)(i.Z,{value:"REST API",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/transactions-rest-api?version=3.0.0&apiversion=v3#operation/getTransactionBufferStats"},"GET /admin/v3/transactions/transactionBufferStats/:tenant/:namespace:/:topic:/:subName"))),(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"admin.transactions().getTransactionBufferStats(topic, lowWaterMarks);\n")))),(0,r.kt)("p",null,"The following is an example of the returned values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "state" : "Ready",\n  "maxReadPosition" : "38:101",\n  "lastSnapshotTimestamps" : 1657021903534,\n  "lowWaterMarks" : {\n    "1" : -1,\n    "2" : -1\n  },\n  "ongoingTxnSize" : 0,\n  "recoverStartTime" : 1657021892850,\n  "recoverEndTime" : 1657021893372\n}\n')))}g.isMDXComponent=!0}}]);