"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[86659],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=r.createContext({}),s=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=s(a),h=n,m=d["".concat(p,".").concat(h)]||d[h]||u[h]||i;return a?r.createElement(m,l(l({ref:t},c),{},{components:a})):r.createElement(m,l({ref:t},c))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=h;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:n,l[1]=o;for(var s=2;s<i;s++)l[s]=a[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},31342:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var r=a(87462),n=(a(67294),a(3905));const i={author:"Technoboy-, Anonymitaet",title:"What\u2019s New in Apache Pulsar 2.7.4"},l=void 0,o={permalink:"/blog/2021/12/14/Apache-Pulsar-2-7-4",editUrl:"https://github.com/apache/pulsar-site/edit/main/blog/2021-12-14-Apache-Pulsar-2-7-4.md",source:"@site/blog/2021-12-14-Apache-Pulsar-2-7-4.md",title:"What\u2019s New in Apache Pulsar 2.7.4",description:"The Apache Pulsar community releases version 2.7.4! 32 contributors provided improvements and bug fixes that delivered 98 commits.",date:"2021-12-14T00:00:00.000Z",formattedDate:"December 14, 2021",tags:[],readingTime:4.39,hasTruncateMarker:!0,authors:[{name:"Technoboy-, Anonymitaet"}],frontMatter:{author:"Technoboy-, Anonymitaet",title:"What\u2019s New in Apache Pulsar 2.7.4"},prevItem:{title:"What\u2019s New in Apache Pulsar 2.9.2",permalink:"/blog/2022/04/08/Apache-Pulsar-2-9-2"},nextItem:{title:"Log4j2 Zero Day vulnerability (CVE-2021-44228)",permalink:"/blog/2021/12/11/Log4j-CVE"}},p={authorsImageUrls:[void 0]},s=[{value:"Upgrade Log4j to 2.17.0 - CVE-2021-45105. PR-13392",id:"upgrade-log4j-to-2170---cve-2021-45105-pr-13392",level:3},{value:"<code>ManagedLedger</code> can be referenced correctly when <code>OpAddEntry</code> is recycled. PR-12103",id:"managedledger-can-be-referenced-correctly-when-opaddentry-is-recycled-pr-12103",level:3},{value:"No potential race condition in the <code>BlobStoreBackedReadHandler</code>. PR-12123",id:"no-potential-race-condition-in-the-blobstorebackedreadhandler-pr-12123",level:3},{value:"NPE does not occur on <code>OpAddEntry</code> while ManagedLedger is closing. PR-12364",id:"npe-does-not-occur-on-opaddentry-while-managedledger-is-closing-pr-12364",level:3},{value:"Set a topic policy through the topic name of a partition correctly. PR-11294",id:"set-a-topic-policy-through-the-topic-name-of-a-partition-correctly-pr-11294",level:3},{value:"Dispatch rate limiter takes effect for consumers. PR-8611",id:"dispatch-rate-limiter-takes-effect-for-consumers-pr-8611",level:3},{value:"NPE does not occur when executing unload bundles operations. PR-11310",id:"npe-does-not-occur-when-executing-unload-bundles-operations-pr-11310",level:3},{value:"Fix inconsistent behavior for Namespace bundles cache. PR-11346",id:"fix-inconsistent-behavior-for-namespace-bundles-cache-pr-11346",level:3},{value:"Close the replicator and replication client after a cluster is deleted. PR-11342",id:"close-the-replicator-and-replication-client-after-a-cluster-is-deleted-pr-11342",level:3},{value:"Publish rate limiter takes effect as expected. PR-10384",id:"publish-rate-limiter-takes-effect-as-expected-pr-10384",level:3},{value:"Clean up newly created  ledgers if fails to update ZNode list. PR-12015",id:"clean-up-newly-created--ledgers-if-fails-to-update-znode-list-pr-12015",level:3}],c={toc:s};function d(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"The Apache Pulsar community releases version 2.7.4! 32 contributors provided improvements and bug fixes that delivered 98 commits."),(0,n.kt)("p",null,"Highlights of this release are as below:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Upgrade Log4j to 2.17.0 - ",(0,n.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/blog/2021/12/11/Log4j-CVE/"},"CVE-2021-45105"),". ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/pull/13392"},"PR-13392"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"ManagedLedger")," can be referenced correctly when ",(0,n.kt)("inlineCode",{parentName:"p"},"OpAddEntry")," is recycled. ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/pull/12103"},"PR-12103"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"NPE does not occur on ",(0,n.kt)("inlineCode",{parentName:"p"},"OpAddEntry")," while ManagedLedger is closing. ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/pull/12364"},"PR-12364")))),(0,n.kt)("p",null,"This blog walks through the most noteworthy changes grouped by the affected functionalities. For the complete list including all enhancements and bug fixes, check out the ",(0,n.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/en/release-notes/#274"},"Pulsar 2.7.4 Release Notes"),"."),(0,n.kt)("h1",{id:"notable-bug-fixes-and-enhancements"},"Notable bug fixes and enhancements"),(0,n.kt)("h3",{id:"upgrade-log4j-to-2170---cve-2021-45105-pr-13392"},"Upgrade Log4j to 2.17.0 - ",(0,n.kt)("a",{parentName:"h3",href:"https://pulsar.apache.org/blog/2021/12/11/Log4j-CVE/"},"CVE-2021-45105"),". ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/13392"},"PR-13392")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"A serious vulnerability was reported regarding Log4j that can allow remote execution for attackers. The vulnerability issue is described and tracked under ",(0,n.kt)("a",{parentName:"p",href:"https://nvd.nist.gov/vuln/detail/CVE-2021-44228"},"CVE-2021-44228"),".")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Pulsar 2.7.4 upgraded Log4j to 2.17.0."))),(0,n.kt)("h3",{id:"managedledger-can-be-referenced-correctly-when-opaddentry-is-recycled-pr-12103"},(0,n.kt)("inlineCode",{parentName:"h3"},"ManagedLedger")," can be referenced correctly when ",(0,n.kt)("inlineCode",{parentName:"h3"},"OpAddEntry")," is recycled. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/12103"},"PR-12103")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"Previously, after a write failure, a task was scheduled in the background to force close the ledger and trigger the creation of  a new ledger. If the ",(0,n.kt)("inlineCode",{parentName:"p"},"OpAddEntry")," instance was already recycled, that could lead to either an NPE or undefined behavior.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"The ",(0,n.kt)("inlineCode",{parentName:"p"},"ManagedLedgerImpl")," object reference is copied to a final variable so the background task will not be dependent on the lifecycle of the ",(0,n.kt)("inlineCode",{parentName:"p"},"OpAddEntry")," instance."))),(0,n.kt)("h3",{id:"no-potential-race-condition-in-the-blobstorebackedreadhandler-pr-12123"},"No potential race condition in the ",(0,n.kt)("inlineCode",{parentName:"h3"},"BlobStoreBackedReadHandler"),". ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/12123"},"PR-12123")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"Previously, ",(0,n.kt)("inlineCode",{parentName:"p"},"BlobStoreBackedReadHandler")," entered an infinite loop when reading an offload ledger. There was a race condition between the operation of reading entries and closing BlobStoreBackedReadHandler.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Added a state check before reading entries and made the ",(0,n.kt)("inlineCode",{parentName:"p"},"BlobStoreBackedReadHandler")," exit loop when the ",(0,n.kt)("inlineCode",{parentName:"p"},"entryID")," is bigger than the ",(0,n.kt)("inlineCode",{parentName:"p"},"lastEntryID"),"."))),(0,n.kt)("h3",{id:"npe-does-not-occur-on-opaddentry-while-managedledger-is-closing-pr-12364"},"NPE does not occur on ",(0,n.kt)("inlineCode",{parentName:"h3"},"OpAddEntry")," while ManagedLedger is closing. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/12364"},"PR-12364")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")," "),(0,n.kt)("p",{parentName:"li"},"Previously, the test ",(0,n.kt)("inlineCode",{parentName:"p"},"ManagedLedgerBkTest#managedLedgerClosed")," closed ManagedLedger object on some ",(0,n.kt)("inlineCode",{parentName:"p"},"asyncAddEntry")," operations and failed with NPE.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Closed ",(0,n.kt)("inlineCode",{parentName:"p"},"OpAddEntry"),"  when ",(0,n.kt)("inlineCode",{parentName:"p"}," ManagedLedger")," signaled  ",(0,n.kt)("inlineCode",{parentName:"p"},"OpAddEntry")," to fail. In this way, the ",(0,n.kt)("inlineCode",{parentName:"p"},"OpAddEntry")," object was correctly recycled and the failed callback was correctly triggered."))),(0,n.kt)("h3",{id:"set-a-topic-policy-through-the-topic-name-of-a-partition-correctly-pr-11294"},"Set a topic policy through the topic name of a partition correctly. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/11294"},"PR-11294")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"Previously, the topic name of a partition could not be used to set a topic policy.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Allowed setting a topic policy through a topic name of a partition by converting the topic name of a partition in ",(0,n.kt)("inlineCode",{parentName:"p"},"SystemTopicBasedTopicPoliciesService"),"."))),(0,n.kt)("h3",{id:"dispatch-rate-limiter-takes-effect-for-consumers-pr-8611"},"Dispatch rate limiter takes effect for consumers. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/8611"},"PR-8611")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"Previously, dispatch rate limiter did not take effect in cases where all consumers started reading in the next second since ",(0,n.kt)("inlineCode",{parentName:"p"},"acquiredPermits")," was reset to 0 every second.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Changed the behaviour of ",(0,n.kt)("inlineCode",{parentName:"p"},"DispatchRateLimiter")," by minus ",(0,n.kt)("inlineCode",{parentName:"p"},"permits")," every second instead of reset ",(0,n.kt)("inlineCode",{parentName:"p"},"acquiredPermits")," to 0. Consumers stopped reading entries temporarily until ",(0,n.kt)("inlineCode",{parentName:"p"},"acquiredPermits")," returned to a value less than ",(0,n.kt)("inlineCode",{parentName:"p"},"permits")," ."))),(0,n.kt)("h3",{id:"npe-does-not-occur-when-executing-unload-bundles-operations-pr-11310"},"NPE does not occur when executing unload bundles operations. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/11310"},"PR-11310")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"When performing pressure tests on persistent partitioned topics, NPE occurred when executing unload bundles operations. Concurrently, producers did not write messages.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Added more safety checks to fix this issue."))),(0,n.kt)("h3",{id:"fix-inconsistent-behavior-for-namespace-bundles-cache-pr-11346"},"Fix inconsistent behavior for Namespace bundles cache. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/11346"},"PR-11346")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"Previously, namespace bundle cache was not invalidated after a namespace was deleted.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Invalidated namespace policy cache when bundle cache was invalidated."))),(0,n.kt)("h3",{id:"close-the-replicator-and-replication-client-after-a-cluster-is-deleted-pr-11342"},"Close the replicator and replication client after a cluster is deleted. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/11342"},"PR-11342")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"Previously, the replicator and the replication client were not closed after a cluster was deleted. The producer of the replicator would then try to reconnect to the deleted cluster continuously.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Closed the relative replicator and replication client."))),(0,n.kt)("h3",{id:"publish-rate-limiter-takes-effect-as-expected-pr-10384"},"Publish rate limiter takes effect as expected. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/10384"},"PR-10384")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"Previously, there were various issues if ",(0,n.kt)("inlineCode",{parentName:"p"},"preciseTopicPublishRateLimiterEnable"),"  was set to ",(0,n.kt)("inlineCode",{parentName:"p"},"true")," for rate limiting:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Updating the limits did not set a boundary when changing the limits from a bounded limit to an unbounded limit.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Each topic created a scheduler thread for each limiter instance.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Topics did not release the scheduler thread when the topic was unloaded or the operation closed.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Updating the limits did not close the scheduler thread related to the replaced limiter instance")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Cleaned up the previous limiter instances before creating new limiter instances.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Used ",(0,n.kt)("inlineCode",{parentName:"p"},"brokerService.pulsar().getExecutor()")," as the scheduler for the rate limiter instances.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Added resource cleanup hooks for topic closing (unload)."))))),(0,n.kt)("h3",{id:"clean-up-newly-created--ledgers-if-fails-to-update-znode-list-pr-12015"},"Clean up newly created  ledgers if fails to update ZNode list. ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/apache/pulsar/pull/12015"},"PR-12015")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Issue")),(0,n.kt)("p",{parentName:"li"},"When updating a ZNode list, ZooKeeper threw an exception and did not clean up the created ledger. Newly created ledgers were not  indexed to a topic ",(0,n.kt)("inlineCode",{parentName:"p"},"managedLedger")," list and could not be cleared up as topic retention. Also, ZNode numbers increased in ZooKeeper if the ZNode version mismatch exception was thrown out.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resolution")),(0,n.kt)("p",{parentName:"li"},"Deleted the created ledger from broker cache and BookKeeper regardless of exception type when the ZNode list failed to update."))),(0,n.kt)("h1",{id:"whats-next"},"What\u2019s Next?"),(0,n.kt)("p",null,"If you are interested in learning more about Pulsar 2.7.4, you can ",(0,n.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/en/versions/"},"download")," and try it out now! "),(0,n.kt)("p",null,"Pulsar Summit Asia 2021 will take place on January 15-16, 2022. ",(0,n.kt)("a",{parentName:"p",href:"https://pulsar-summit.org/"},"Register now")," and help us make it an even bigger success by spreading the word on social media!"),(0,n.kt)("p",null,"For more information about the Apache Pulsar project and current  progress, visit\nthe ",(0,n.kt)("a",{parentName:"p",href:"https://pulsar.apache.org"},"Pulsar website"),", follow the project on Twitter ",(0,n.kt)("a",{parentName:"p",href:"https://twitter.com/apache_pulsar"},"@apache_pulsar"),", and join ",(0,n.kt)("a",{parentName:"p",href:"https://apache-pulsar.herokuapp.com/"},"Pulsar Slack"),"!"))}d.isMDXComponent=!0}}]);