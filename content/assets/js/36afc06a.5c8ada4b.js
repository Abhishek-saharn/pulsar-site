"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[74039],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},b=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=d(a),b=r,m=p["".concat(s,".").concat(b)]||p[b]||u[b]||l;return a?n.createElement(m,o(o({ref:t},c),{},{components:a})):n.createElement(m,o({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,o=new Array(l);o[0]=b;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,o[1]=i;for(var d=2;d<l;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}b.displayName="MDXCreateElement"},88726:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>d});var n=a(87462),r=(a(67294),a(3905));const l={id:"concepts-broker-load-balancing-types",title:"Types",sidebar_label:"Types"},o=void 0,i={unversionedId:"concepts-broker-load-balancing-types",id:"concepts-broker-load-balancing-types",title:"Types",description:"Pulsar provides three types of broker load balancers:",source:"@site/docs/concepts-broker-load-balancing-types.md",sourceDirName:".",slug:"/concepts-broker-load-balancing-types",permalink:"/docs/next/concepts-broker-load-balancing-types",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/docs/concepts-broker-load-balancing-types.md",tags:[],version:"current",frontMatter:{id:"concepts-broker-load-balancing-types",title:"Types",sidebar_label:"Types"},sidebar:"docsSidebar",previous:{title:"Concepts",permalink:"/docs/next/concepts-broker-load-balancing-concepts"},next:{title:"Geo Replication",permalink:"/docs/next/concepts-replication"}},s={},d=[{value:"Side-by-side comparisons",id:"side-by-side-comparisons",level:2},{value:"Performance tests",id:"performance-tests",level:2},{value:"Related topics",id:"related-topics",level:2}],c={toc:d},p="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Pulsar provides three types of broker load balancers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Simple broker load balancer: it existed since Pulsar's inception, but now is deprecated. No one uses it.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"#side-by-side-comparisons"},"Modular broker load balancer"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"#side-by-side-comparisons"},"Extensible broker load balancer")))),(0,r.kt)("p",null,"The modular and extensible broker load balancer use similar implementation logic and algorithm and have similar functionalities. For example, they both employ a similar approach to distributing data loads among brokers, including:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Dynamic ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-assignment"},"bundle-broker assignment"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Dynamic ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-splitting"},"bundle splitting"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Dynamic ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-unloading"},"bundle unloading (shedding)"),"  "))),(0,r.kt)("p",null,"As a result, brokers dynamically collect and share the current load with other brokers for better load balancing decisions. "),(0,r.kt)("h2",{id:"side-by-side-comparisons"},"Side-by-side comparisons"),(0,r.kt)("p",null,"The extensible broker load balancer refactors the logic of the modular broker load balancer with better modularity and is less dependent on ZooKeeper, which makes Pulsar more stable and scalable. "),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Dimension"),(0,r.kt)("th",{parentName:"tr",align:null},"Modular broker load balancer"),(0,r.kt)("th",{parentName:"tr",align:null},"Extensible broker load balancer"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Available version"),(0,r.kt)("td",{parentName:"tr",align:null},"Pulsar 1.7.0 ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null),"2017"),(0,r.kt)("td",{parentName:"tr",align:null},"Pulsar 3.0.0 ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null),"2023")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Architecture"),(0,r.kt)("td",{parentName:"tr",align:null},"ZooKeeper plays an important role, which may cause a large overhead of load data replication.",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," All broker load data and all bundle load data are stored in ZooKeeper and replicated to all brokers via ZooKeeper watchers."),(0,r.kt)("td",{parentName:"tr",align:null},"ZooKeeper is less dependent (only lookup data is stored in ZooKeeper), which reduces the overhead of load data replication and minimizes data processing delays.",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," Pulsar reads and writes data via system topics and table view rather than ZooKeeper: ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - ",(0,r.kt)("a",{parentName:"td",href:"/docs/next/concepts-messaging#system-topic"},"System topics"),": global ownership data is stored in bundle state channels within persistent topics. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - ",(0,r.kt)("a",{parentName:"td",href:"/docs/next/concepts-clients#tableview"},"Table view"),": global ownership data is replicated using the compacted table view, where 1) All broker load data is replicated to all brokers via non-persistent topics. 2) Only the top-n bundle load data from each broker is replicated to the leader brokers via non-persistent topics. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," The absolute size of the shared load data and the complexity of the replication decreased due to passing the data through memory-only, non-persistent topics.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Performance (1/2)"),(0,r.kt)("td",{parentName:"tr",align:null},"Load balance decisions might be made slowly, and data load might be distributed unevenly. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - Single leader broker decides on bundle-broker assignment, bundle splitting, and bundle unloading. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - This requires all load information to be passed to the leader broker, which may delay load balance executions."),(0,r.kt)("td",{parentName:"tr",align:null},"It optimizes the overall performance, such as load balance decisions are made faster, and data load is distributed more evenly. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - Each broker decides and runs bundle-broker assignments and bundle splitting. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - The leader broker still decides on bundle unloading globally. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - The load balance decisions are more distributed across brokers, expecting quicker load balance operations.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Performance (2/2)"),(0,r.kt)("td",{parentName:"tr",align:null},"Topics might be temporarily unavailable during the bundle unloading process. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," -  When bundles are unloaded, the topics in the bundles will be closed, and producers and consumers need to reconnect to new owner brokers. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - This new assignment process involves redirections talking to multiple brokers (including the leader broker), and this redirection can delay the reconnections of producers and consumers."),(0,r.kt)("td",{parentName:"tr",align:null},"Topics are more available during the bundle unloading process because the time of the reconnection from producers to consumers is faster. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - The time of unloading bundles (topics) automatically is faster. A new unloading strategy, ",(0,r.kt)("a",{parentName:"td",href:"/docs/next/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"TransferShedder"),", is introduced as the default behavior, which means new brokers will be pre-assigned before topic connections are closed. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," - The time of unloading bundles (topics) manually is faster. The logic of pulsar-admin transfer is refactored and improved. The pub/consumers can connect to the new owner broker with lesser redirections. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null)," For detailed performance comparison results between the extensible broker load balancer and the modular broker load balancer, see ",(0,r.kt)("a",{parentName:"td",href:"#performance-tests"},"performance tests"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Observability"),(0,r.kt)("td",{parentName:"tr",align:null},"You can monitor and analyze load balance with various ",(0,r.kt)("a",{parentName:"td",href:"/docs/next/reference-metrics"},"metrics")," and the ",(0,r.kt)("a",{parentName:"td",href:"pathname:///reference/#/next/pulsar-perf/"},"pulsar-perf")," tool."),(0,r.kt)("td",{parentName:"tr",align:null},"It improves the efficiency of monitoring and analyzing load balance by introducing more ",(0,r.kt)("a",{parentName:"td",href:"/docs/next/reference-metrics"},"metrics"),", a dedicated dashboard, a new log tool, and a new flag (",(0,r.kt)("inlineCode",{parentName:"td"},"--extensions"),") of the pulsar-perf tool, which allows you to perform more management operations. For example: ",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Check the status of load balance decision breakdown and failure. ",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Monitor metrics in dashboard. ",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Use dynamic debug mode configurations to print more load balance decision logs.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Flexibility"),(0,r.kt)("td",{parentName:"tr",align:null},"You can set configurations for the load balance. For example,",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Adjust thresholds dynamically (e.g., max number of bundles, bundle splitting conditions, etc). ",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Set unloading cycle delays. ",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Configure bundle split intervals.",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Customize load balance strategy."),(0,r.kt)("td",{parentName:"tr",align:null},"It increases the flexibility of managing load balance by introducing more configurations, which allows you to set more of them. For example,",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Configure bundle cleanup delays. ",(0,r.kt)("br",null),(0,r.kt)("br",null)," - Set broker load data TTL.")))),(0,r.kt)("h2",{id:"performance-tests"},"Performance tests"),(0,r.kt)("p",null,"The following tests have been conducted to explicitly show the performance improvement on the extensible broker load balancer."),(0,r.kt)("p",null,"This test is conducted on Pulsar 3.0.0."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Dimension"),(0,r.kt)("th",{parentName:"tr",align:null},"Goal"),(0,r.kt)("th",{parentName:"tr",align:null},"Test case"),(0,r.kt)("th",{parentName:"tr",align:null},"Modular broker load balancer"),(0,r.kt)("th",{parentName:"tr",align:null},"Extensible broker load balancer"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Scalability"),(0,r.kt)("td",{parentName:"tr",align:null},"Verify if the extensible broker load balancer can decrease the start and end time to reconnect publishers when a large Pulsar cluster with many bundles restarts all brokers in a short period."),(0,r.kt)("td",{parentName:"tr",align:null},"Measure the connection recovery time of 100,000 publishers when restarting 100 brokers with 65,000 distributed bundles in 2 mins."),(0,r.kt)("td",{parentName:"tr",align:null},"20 mins"),(0,r.kt)("td",{parentName:"tr",align:null},"10 mins")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Publisher latency"),(0,r.kt)("td",{parentName:"tr",align:null},"Verify if the extensible broker load balancer can decrease individual message delays when topics are unloaded to other brokers."),(0,r.kt)("td",{parentName:"tr",align:null},"Measure the latency time of P99.99 of messages (10,000 partitions, 1,000 bundles at 1,000 msgs/s) when restarting a cluster restarts 10 brokers one by one."),(0,r.kt)("td",{parentName:"tr",align:null},"1841 ms"),(0,r.kt)("td",{parentName:"tr",align:null},"1228 ms")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Unload balance (1/2)"),(0,r.kt)("td",{parentName:"tr",align:null},"Verify if the extensible broker load balancer can decrease the load balance time if some brokers join or leave a cluster."),(0,r.kt)("td",{parentName:"tr",align:null},"Measure the time to balance the load (10,000 topics/publishers, 100 bundles) from scaling up from 5 brokers to 10 brokers."),(0,r.kt)("td",{parentName:"tr",align:null},"7 mins ",(0,r.kt)("br",null),(0,r.kt)("br",null)," The load cannot be balanced without further tuning."),(0,r.kt)("td",{parentName:"tr",align:null},"5 mins ",(0,r.kt)("br",null),(0,r.kt)("br",null)," The load can be balanced without further tuning.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Unload balance (2/2)"),(0,r.kt)("td",{parentName:"tr",align:null},"Same as above"),(0,r.kt)("td",{parentName:"tr",align:null},"Measure the time to balance the load (10,000 topics/publishers, 100 bundles) from scaling down from 10 brokers to 5 brokers."),(0,r.kt)("td",{parentName:"tr",align:null},"5 mins"),(0,r.kt)("td",{parentName:"tr",align:null},"3 mins")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Split balance"),(0,r.kt)("td",{parentName:"tr",align:null},"Verify if the extensible broker load balancer can decrease the time of automatic bundle splitting and balance the overloaded topics."),(0,r.kt)("td",{parentName:"tr",align:null},"Measure the time of splitting 1 bundle into 128 bundles and balancing the load (10,000 topics/publishers) when hot-spot topics have high loads."),(0,r.kt)("td",{parentName:"tr",align:null},"15 mins"),(0,r.kt)("td",{parentName:"tr",align:null},"13 mins")))),(0,r.kt)("h2",{id:"related-topics"},"Related topics"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To get a comprehensive understanding and discover the key insights, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-overview"},"Broker load balancing | Overview"),". ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To discover different usage scenarios, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-use-cases"},"Broker load balancing | Use cases"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To explore functionalities, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-features"},"Broker load balancing | Features"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To understand advantages, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-benefits"},"Broker load balancing | Benefits"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To learn essential fundamentals, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/concepts-broker-load-balancing-concepts"},"Broker load balancing | Concepts"),"."))))}u.isMDXComponent=!0}}]);