"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[28724],{3905:(e,a,t)=>{t.d(a,{Zo:()=>s,kt:()=>k});var r=t(67294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var d=r.createContext({}),p=function(e){var a=r.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},s=function(e){var a=p(e.components);return r.createElement(d.Provider,{value:a},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},b=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,l=e.originalType,d=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),c=p(t),b=n,k=c["".concat(d,".").concat(b)]||c[b]||m[b]||l;return t?r.createElement(k,o(o({ref:a},s),{},{components:t})):r.createElement(k,o({ref:a},s))}));function k(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var l=t.length,o=new Array(l);o[0]=b;var i={};for(var d in a)hasOwnProperty.call(a,d)&&(i[d]=a[d]);i.originalType=e,i[c]="string"==typeof e?e:n,o[1]=i;for(var p=2;p<l;p++)o[p]=t[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}b.displayName="MDXCreateElement"},37314:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var r=t(87462),n=(t(67294),t(3905));const l={id:"concepts-broker-load-balancing-migration",title:"Migration",sidebar_label:"Migration"},o=void 0,i={unversionedId:"concepts-broker-load-balancing-migration",id:"version-3.1.x/concepts-broker-load-balancing-migration",title:"Migration",description:"Pulsar has 3 types of broker load balancers, that is, simple, modular, and extensible.",source:"@site/versioned_docs/version-3.1.x/concepts-broker-load-balancing-migration.md",sourceDirName:".",slug:"/concepts-broker-load-balancing-migration",permalink:"/docs/3.1.x/concepts-broker-load-balancing-migration",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-3.1.x/concepts-broker-load-balancing-migration.md",tags:[],version:"3.1.x",frontMatter:{id:"concepts-broker-load-balancing-migration",title:"Migration",sidebar_label:"Migration"},sidebar:"docsSidebar",previous:{title:"Quick start",permalink:"/docs/3.1.x/concepts-broker-load-balancing-quick-start"},next:{title:"Geo Replication",permalink:"/docs/3.1.x/concepts-replication"}},d={},p=[{value:"Considerations",id:"considerations",level:2},{value:"Migrate from simple to modular broker load balancer",id:"migrate-from-simple-to-modular-broker-load-balancer",level:2},{value:"Change broker.conf file",id:"change-brokerconf-file",level:3},{value:"Use pulsar-admin tool",id:"use-pulsar-admin-tool",level:3},{value:"Migrate from modular to extensible broker load balancer",id:"migrate-from-modular-to-extensible-broker-load-balancer",level:2},{value:"Change broker.conf file",id:"change-brokerconf-file-1",level:3},{value:"Migrate from extensible to modular broker load balancer",id:"migrate-from-extensible-to-modular-broker-load-balancer",level:2},{value:"Change broker.conf file",id:"change-brokerconf-file-2",level:3},{value:"Related topics",id:"related-topics",level:2}],s={toc:p},c="wrapper";function m(e){let{components:a,...t}=e;return(0,n.kt)(c,(0,r.Z)({},s,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Pulsar has 3 types of broker load balancers, that is, simple, modular, and extensible. "),(0,n.kt)("p",null,"You can perform the following migrations."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Migration"),(0,n.kt)("th",{parentName:"tr",align:null},"When to use"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"#migrate-from-simple-to-modular-broker-load-balancer"},"Migrate from simple to modular")),(0,n.kt)("td",{parentName:"tr",align:null},"If you want to use the ",(0,n.kt)("a",{parentName:"td",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategy")," of OverloadShedder, ThresholdShedder, or UniformLoadShedder.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"#migrate-from-modular-to-extensible-broker-load-balancer"},"Migrate from modular to extensible")),(0,n.kt)("td",{parentName:"tr",align:null},"If you want to use the ",(0,n.kt)("a",{parentName:"td",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategy")," of TransferShedder.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"#migrate-from-modular-to-extensible-broker-load-balancer"},"Migrate from extensible to modular")),(0,n.kt)("td",{parentName:"tr",align:null},"If you want to use the ",(0,n.kt)("a",{parentName:"td",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategy")," of OverloadShedder, ThresholdShedder, or UniformLoadShedder.")))),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"It is not recommended to migrate from the modular or extensible to the simple broker load balancer since the simple broker load balancer is deprecated and no longer in use.")),(0,n.kt)("h2",{id:"considerations"},"Considerations"),(0,n.kt)("p",null,"Before migrating from one broker load balancer type to another, review the relationship between ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-types"},"broker load balancer type"),", Pulsar version, and ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategy"),". You may need to upgrade Pulsar versions or update the ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategy"),". Below are brief summaries."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"This broker load balancer type"),(0,n.kt)("th",{parentName:"tr",align:null},"is available in this Pulsar version"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Simple"),(0,n.kt)("td",{parentName:"tr",align:null},"All versions")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Modular"),(0,n.kt)("td",{parentName:"tr",align:null},"1.7 and later")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Extensible"),(0,n.kt)("td",{parentName:"tr",align:null},"3.0 and later")))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"This bundle unloading strategy"),(0,n.kt)("th",{parentName:"tr",align:null},"is available for this broker load balancer type"),(0,n.kt)("th",{parentName:"tr",align:null},"in available this Pulsar version"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"OverloadShedder"),(0,n.kt)("td",{parentName:"tr",align:null},"Modular"),(0,n.kt)("td",{parentName:"tr",align:null},"1.18 and later")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ThresholdShedder"),(0,n.kt)("td",{parentName:"tr",align:null},"Modular"),(0,n.kt)("td",{parentName:"tr",align:null},"2.6 and later")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"UniformLoadShedder"),(0,n.kt)("td",{parentName:"tr",align:null},"Modular"),(0,n.kt)("td",{parentName:"tr",align:null},"2.10 and later")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"TransferShedder"),(0,n.kt)("td",{parentName:"tr",align:null},"Extensible"),(0,n.kt)("td",{parentName:"tr",align:null},"3.0 and later")))),(0,n.kt)("h2",{id:"migrate-from-simple-to-modular-broker-load-balancer"},"Migrate from simple to modular broker load balancer"),(0,n.kt)("p",null,"You can migrate from the simple to the modular broker load balancer, by manually changing the configuration settings in the broker.conf file or by using the pulsar-admin tool. "),(0,n.kt)("h3",{id:"change-brokerconf-file"},"Change broker.conf file"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Access to the broker.conf file."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"vim apache-pulsar-3.1.0/conf/broker.conf\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the broker load balancer by setting ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1309C20-L1309C20"},"loadManagerClassName")," to ",(0,n.kt)("inlineCode",{parentName:"p"},"ModularLoadManagerImpl")," in the broker.conf file."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-conf"},"loadManagerClassName=org.apache.pulsar.broker.loadbalance.extensions.ModularLoadManagerImpl\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Restart the Pulsar cluster. The new setting will take effect after the restart.  "))),(0,n.kt)("h3",{id:"use-pulsar-admin-tool"},"Use pulsar-admin tool"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Access the ",(0,n.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/docs/next/reference-cli-tools/"},"pulsar-admin tool"),"."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"cd apache-pulsar-3.1.0/bin\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Set ",(0,n.kt)("inlineCode",{parentName:"p"},"--config")," to ",(0,n.kt)("inlineCode",{parentName:"p"},"loadManagerClassName")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"--value")," to ",(0,n.kt)("inlineCode",{parentName:"p"},"org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl"),"."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"pulsar-admin brokers update-dynamic-config \\\n--config loadManagerClassName \\\n--value org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl\n")),(0,n.kt)("p",{parentName:"li"},"You do not need to restart the Pulsar cluster. The new settings will take effect after 1 to 2 minutes."))),(0,n.kt)("h2",{id:"migrate-from-modular-to-extensible-broker-load-balancer"},"Migrate from modular to extensible broker load balancer"),(0,n.kt)("p",null,"You can migrate from the modular to the extensible broker load balancer, by manually changing settings in the broker.conf file. During the migration, the lookup and assignment will be redirected to the brokers with the extensible load balancer."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"The pulsar-admin tool is not supported for this migration.")),(0,n.kt)("h3",{id:"change-brokerconf-file-1"},"Change broker.conf file"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/helm-upgrade"},"Upgrade the Pulsar cluster")," to 3.0.0 or later versions.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Access to the broker.conf file."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"vim apache-pulsar-3.1.0/conf/broker.conf\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the following settings in the broker.conf file:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Update ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-overview"},"broker load balancer")," by setting ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1309C20-L1309C20"},"loadManagerClassName")," to ",(0,n.kt)("inlineCode",{parentName:"p"},"ExtensibleLoadManagerImpl"),". ")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Update ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategy")," by setting ",(0,n.kt)("inlineCode",{parentName:"p"},"loadBalancerLoadSheddingStrategy")," to ",(0,n.kt)("inlineCode",{parentName:"p"},"TransferShedder"),". "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-conf"},"loadManagerClassName=org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl \n\nloadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.extensions.scheduler.TransferShedder\n")),(0,n.kt)("admonition",{parentName:"li",type:"note"},(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"The ",(0,n.kt)("a",{parentName:"li",href:"/docs/3.1.x/concepts-broker-load-balancing-types"},"extensible broker load balancer")," is ",(0,n.kt)("strong",{parentName:"li"},"available in Pulsar 3.0.0")," or later."),(0,n.kt)("li",{parentName:"ul"},"The ",(0,n.kt)("a",{parentName:"li",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"TransferShedder unloading strategy")," is ",(0,n.kt)("strong",{parentName:"li"},"only available")," in the ",(0,n.kt)("a",{parentName:"li",href:"/docs/3.1.x/concepts-broker-load-balancing-types"},"extensible load balancer"),".")))))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Restart the Pulsar cluster. The new settings will take effect after the restart.  "))),(0,n.kt)("h2",{id:"migrate-from-extensible-to-modular-broker-load-balancer"},"Migrate from extensible to modular broker load balancer"),(0,n.kt)("p",null,"You can migrate from the extensible to the modular broker load balancer, by manually changing the setting in the broker.conf file. During the migration, the lookup and assignment will be redirected to the brokers with the modular load balancer."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"The pulsar-admin tool is not supported for this migration.")),(0,n.kt)("h3",{id:"change-brokerconf-file-2"},"Change broker.conf file"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Access to the broker.conf file."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"vim apache-pulsar-3.1.0/conf/broker.conf\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Change the following settings in the broker.conf file:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Update broker load balancer by setting ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/69d7a2bf14555f11a716a9545c5cf391d8179a27/conf/broker.conf#L1309C20-L1309C20"},"loadManagerClassName")," to ModularLoadManagerImpl")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Update ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategy")," to OverloadShedder, ThresholdShedder, or UniformLoadShedder based on your needs."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre"},"loadManagerClassName=org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl\n\nloadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.impl.ThresholdShedder\n")),(0,n.kt)("admonition",{parentName:"li",type:"note"},(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"TransferShedder")," is ",(0,n.kt)("strong",{parentName:"p"},"only supported")," in the extensible broker load balancer, so you need to change TransferShedder to other ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts#bundle-unloading-strategies"},"bundle unloading strategies"),"."))))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Restart the Pulsar cluster. The new settings will take effect after the restart.  "))),(0,n.kt)("h2",{id:"related-topics"},"Related topics"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"To get a comprehensive understanding and discover the key insights, see ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-overview"},"Broker load balancing | Overview"),". ")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"To discover different usage scenarios, see ",(0,n.kt)("a",{parentName:"p",href:"./concepts-broker-load-balancing-use-cases.md"},"Broker load balancing | Use cases"),".")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"To explore functionalities, see ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-features"},"Broker load balancing | Features"),".")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"To understand advantages, see ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-benefits"},"Broker load balancing | Benefits"),".")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"To learn essential fundamentals, see ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-concepts"},"Broker load balancing | Concepts"),".")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"To review various versions of broker load balancers, see ",(0,n.kt)("a",{parentName:"p",href:"/docs/3.1.x/concepts-broker-load-balancing-types"},"Broker load balancing | Types"),"."))))}m.isMDXComponent=!0}}]);